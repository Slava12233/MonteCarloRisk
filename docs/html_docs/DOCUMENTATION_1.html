
    <!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Google ADK Agent Starter Kit - MonteCarloRisk_AI</title>
        <link rel="stylesheet" href="style.css">
        <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
        <script>
            document.addEventListener('DOMContentLoaded', function() {
                mermaid.initialize({
                    startOnLoad: true,
                    theme: 'default',
                    securityLevel: 'loose',
                    flowchart: { useMaxWidth: false }
                });
            });
        </script>
    </head>
    <body>
        <div class="navbar">
            <h1>MonteCarloRisk_AI</h1>
            <p><a href="index.html" style="color: white;">← Back to Documentation Index</a></p>
        </div>
        
        <h1 id="google-adk-agent-starter-kit">Google ADK Agent Starter Kit</h1>
<h2 id="executive-summary">Executive Summary</h2>
<p>As the co-founder and CTO of our AI Agents company, I'm pleased to present our Google ADK Agent Starter Kit. This toolkit provides a robust foundation for building intelligent agents using Google's Agent Development Kit (ADK). It implements a true custom agent architecture that follows Google's recommended patterns while providing flexibility for future expansion.</p>
<p>This documentation serves as a comprehensive guide for our development team to understand, use, and extend the starter kit for building specialized agents for various use cases.</p>
<h2 id="table-of-contents">Table of Contents</h2>
<ol>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#architecture-overview">Architecture Overview</a></li>
<li><a href="#core-components">Core Components</a></li>
<li><a href="#implementation-details">Implementation Details</a></li>
<li><a href="#getting-started">Getting Started</a></li>
<li><a href="#development-workflow">Development Workflow</a></li>
<li><a href="#testing">Testing</a></li>
<li><a href="#deployment">Deployment</a></li>
<li><a href="#best-practices">Best Practices</a></li>
<li><a href="#troubleshooting">Troubleshooting</a></li>
<li><a href="#future-roadmap">Future Roadmap</a></li>
<li><a href="#references">References</a></li>
</ol>
<h2 id="introduction">Introduction</h2>
<p>The Google ADK Agent Starter Kit provides a standardized foundation for building intelligent agents using Google's Agent Development Kit. It implements a true custom agent architecture that inherits directly from Google's BaseAgent class and follows the recommended patterns for custom agent development.</p>
<h3 id="key-features">Key Features</h3>
<ul>
<li><strong>True Custom Agent Architecture</strong>: Inherits directly from Google's BaseAgent class and implements the required methods.</li>
<li><strong>LLM Integration</strong>: Uses Google's Gemini models for natural language understanding and generation.</li>
<li><strong>Tool Integration</strong>: Seamlessly integrates with Google Search and custom tools.</li>
<li><strong>Flexible Orchestration</strong>: Supports complex orchestration patterns like conditional logic and state management.</li>
<li><strong>Comprehensive Testing</strong>: Includes unit tests for all components.</li>
<li><strong>Interactive Mode</strong>: Supports interactive conversations with the agent.</li>
</ul>
<h2 id="architecture-overview">Architecture Overview</h2>
<p>Our starter kit follows a layered architecture that separates concerns and promotes modularity:</p>
<div class="codehilite"><pre><span></span><code><span class="err">┌─────────────────────────────────────────┐</span>
<span class="err">│</span><span class="w">               </span><span class="nx">Client</span><span class="w"> </span><span class="nx">Layer</span><span class="w">              </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="p">(</span><span class="nx">CLI</span><span class="p">,</span><span class="w"> </span><span class="nx">Web</span><span class="w"> </span><span class="nx">UI</span><span class="p">,</span><span class="w"> </span><span class="nx">API</span><span class="p">,</span><span class="w"> </span><span class="nx">etc</span><span class="p">.)</span><span class="w">               </span><span class="err">│</span>
<span class="err">└───────────────┬─────────────────────────┘</span>
<span class="w">                </span><span class="err">│</span>
<span class="err">┌───────────────▼─────────────────────────┐</span>
<span class="err">│</span><span class="w">             </span><span class="nx">Agent</span><span class="w"> </span><span class="nx">Layer</span><span class="w">                 </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="p">(</span><span class="nx">BaseAgent</span><span class="p">,</span><span class="w"> </span><span class="nx">etc</span><span class="p">.)</span><span class="w">                      </span><span class="err">│</span>
<span class="err">└───────────────┬─────────────────────────┘</span>
<span class="w">                </span><span class="err">│</span>
<span class="err">┌───────────────▼─────────────────────────┐</span>
<span class="err">│</span><span class="w">           </span><span class="nx">Orchestration</span><span class="w"> </span><span class="nx">Layer</span><span class="w">           </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="p">(</span><span class="nx">Custom</span><span class="w"> </span><span class="nx">logic</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nx">_run_async_impl</span><span class="p">)</span><span class="w">      </span><span class="err">│</span>
<span class="err">└───────────────┬─────────────────────────┘</span>
<span class="w">                </span><span class="err">│</span>
<span class="err">┌───────────────▼─────────────────────────┐</span>
<span class="err">│</span><span class="w">             </span><span class="nx">Tool</span><span class="w"> </span><span class="nx">Layer</span><span class="w">                  </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="p">(</span><span class="nx">Google</span><span class="w"> </span><span class="nx">Search</span><span class="p">,</span><span class="w"> </span><span class="nx">Custom</span><span class="w"> </span><span class="nx">Tools</span><span class="p">,</span><span class="w"> </span><span class="nx">etc</span><span class="p">.)</span><span class="w">    </span><span class="err">│</span>
<span class="err">└───────────────┬─────────────────────────┘</span>
<span class="w">                </span><span class="err">│</span>
<span class="err">┌───────────────▼─────────────────────────┐</span>
<span class="err">│</span><span class="w">             </span><span class="nx">Model</span><span class="w"> </span><span class="nx">Layer</span><span class="w">                 </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="p">(</span><span class="nx">Gemini</span><span class="w"> </span><span class="nx">models</span><span class="w"> </span><span class="nx">via</span><span class="w"> </span><span class="nx">Google</span><span class="w"> </span><span class="nx">AI</span><span class="w"> </span><span class="nx">API</span><span class="p">)</span><span class="w">      </span><span class="err">│</span>
<span class="err">└─────────────────────────────────────────┘</span>
</code></pre></div>

<h3 id="key-design-principles">Key Design Principles</h3>
<ol>
<li><strong>Separation of Concerns</strong>: Each layer has a specific responsibility.</li>
<li><strong>Modularity</strong>: Components are designed to be reusable and replaceable.</li>
<li><strong>Extensibility</strong>: The architecture allows for easy extension with new agents, tools, and models.</li>
<li><strong>Testability</strong>: All components are designed to be easily testable.</li>
</ol>
<h2 id="core-components">Core Components</h2>
<h3 id="baseagent">BaseAgent</h3>
<p>The <code>BaseAgent</code> class is the foundation of our agent architecture. It inherits directly from Google's <code>BaseAgent</code> class and implements the required methods for custom agent development.</p>
<p>Key features:
- Implements <code>_run_async_impl</code> for custom orchestration logic
- Manages sub-agents, including an LlmAgent for reasoning
- Handles session management and state
- Provides convenience methods for running the agent and getting responses</p>
<h3 id="custom-tools">Custom Tools</h3>
<p>The starter kit includes support for custom tools that can be used by agents to perform specific tasks.</p>
<p>Key features:
- Implements a <code>CustomTool</code> class for creating new tools
- Provides examples of custom tool implementation
- Includes unit tests for custom tools</p>
<h2 id="implementation-details">Implementation Details</h2>
<h3 id="baseagent-implementation">BaseAgent Implementation</h3>
<p>The <code>BaseAgent</code> class inherits from Google's <code>BaseAgent</code> class and implements the required methods for custom agent development:</p>
<div class="codehilite"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">BaseAgent</span><span class="p">(</span><span class="n">ADKBaseAgent</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Base agent template with common functionality.</span>

<span class="sd">    This class provides a standardized foundation for building agents with</span>
<span class="sd">    Google&#39;s Agent Development Kit (ADK). It inherits directly from ADK&#39;s BaseAgent</span>
<span class="sd">    and implements custom orchestration logic.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Define model_config for Pydantic</span>
    <span class="n">model_config</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;arbitrary_types_allowed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">model</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">DEFAULT_MODEL</span><span class="p">,</span>
        <span class="n">description</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">instruction</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">tools</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">sub_agents</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">session_service</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">app_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="c1"># Initialize the parent class first</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="n">description</span><span class="p">,</span>
            <span class="n">sub_agents</span><span class="o">=</span><span class="n">sub_agents</span> <span class="ow">or</span> <span class="p">[],</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Store parameters as instance attributes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_model</span> <span class="o">=</span> <span class="n">model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_instruction</span> <span class="o">=</span> <span class="n">instruction</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tools</span> <span class="o">=</span> <span class="n">tools</span> <span class="ow">or</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_app_name</span> <span class="o">=</span> <span class="n">app_name</span> <span class="ow">or</span> <span class="n">name</span>

        <span class="c1"># Create the LLM agent that will handle the actual reasoning</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_llm_agent</span> <span class="o">=</span> <span class="n">LlmAgent</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">_llm&quot;</span><span class="p">,</span>
            <span class="n">model</span><span class="o">=</span><span class="n">model</span> <span class="ow">or</span> <span class="n">DEFAULT_MODEL</span><span class="p">,</span>  <span class="c1"># Ensure model is never None</span>
            <span class="n">description</span><span class="o">=</span><span class="n">description</span><span class="p">,</span>
            <span class="n">instruction</span><span class="o">=</span><span class="n">instruction</span><span class="p">,</span>
            <span class="n">tools</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_tools</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Add the LLM agent as a sub-agent if not already added</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_llm_agent</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">agent</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sub_agents</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sub_agents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_llm_agent</span><span class="p">)</span>

        <span class="c1"># Set up session management</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_session_service</span> <span class="o">=</span> <span class="n">session_service</span> <span class="ow">or</span> <span class="n">InMemorySessionService</span><span class="p">()</span>

        <span class="c1"># Create a runner for direct use</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_runner</span> <span class="o">=</span> <span class="n">Runner</span><span class="p">(</span>
            <span class="n">agent</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
            <span class="n">app_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_app_name</span><span class="p">,</span>
            <span class="n">session_service</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_session_service</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="nd">@override</span>
    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_run_async_impl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ctx</span><span class="p">:</span> <span class="n">InvocationContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AsyncGenerator</span><span class="p">[</span><span class="n">Event</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Implement the custom orchestration logic for this agent.</span>

<span class="sd">        This is the core method that defines how this agent processes requests and</span>
<span class="sd">        orchestrates its sub-agents.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">] Starting agent execution&quot;</span><span class="p">)</span>

        <span class="c1"># Process the user&#39;s message using the LLM agent</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">] Running LLM agent&quot;</span><span class="p">)</span>
        <span class="k">async</span> <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_llm_agent</span><span class="o">.</span><span class="n">run_async</span><span class="p">(</span><span class="n">ctx</span><span class="p">):</span>
            <span class="c1"># You can add custom logic here to process events</span>
            <span class="k">yield</span> <span class="n">event</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">] Agent execution completed&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="custom-tools-implementation">Custom Tools Implementation</h3>
<p>The starter kit includes support for custom tools:</p>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_current_time</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the current time.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: The current time in ISO format.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>

<span class="k">def</span><span class="w"> </span><span class="nf">get_random_number</span><span class="p">(</span><span class="n">min_value</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">max_value</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate a random number between min_value and max_value.</span>

<span class="sd">    Args:</span>
<span class="sd">        min_value: The minimum value (inclusive).</span>
<span class="sd">        max_value: The maximum value (inclusive).</span>

<span class="sd">    Returns:</span>
<span class="sd">        int: A random number between min_value and max_value.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">min_value</span><span class="p">,</span> <span class="n">max_value</span><span class="p">)</span>
</code></pre></div>

<h2 id="getting-started">Getting Started</h2>
<h3 id="prerequisites">Prerequisites</h3>
<ul>
<li>Python 3.8 or higher</li>
<li>Google API key for Gemini models</li>
<li>Google Cloud project (for Vertex AI deployment)</li>
</ul>
<h3 id="installation">Installation</h3>
<ol>
<li>
<p>Clone the repository:
   <code>bash
   git clone https://github.com/your-organization/google-adk-agent-starter-kit.git
   cd google-adk-agent-starter-kit</code></p>
</li>
<li>
<p>Create a virtual environment:
   <code>bash
   python -m venv venv
   source venv/bin/activate  # On Windows: venv\Scripts\activate</code></p>
</li>
<li>
<p>Install dependencies:
   <code>bash
   pip install -r requirements.txt</code></p>
</li>
<li>
<p>Set up environment variables:
   <code>bash
   cp .env.example .env
   # Edit .env with your API keys and configuration</code></p>
</li>
</ol>
<h3 id="project-structure">Project Structure</h3>
<p>The project follows a modular structure designed for extensibility:</p>
<div class="codehilite"><pre><span></span><code><span class="n">google</span><span class="o">-</span><span class="n">adk</span><span class="o">-</span><span class="n">agent</span><span class="o">-</span><span class="n">starter</span><span class="o">-</span><span class="n">kit</span><span class="o">/</span>
<span class="err">├──</span><span class="w"> </span><span class="n">README</span><span class="o">.</span><span class="n">md</span><span class="w">                 </span><span class="c1"># Documentation and getting started guide</span>
<span class="err">├──</span><span class="w"> </span><span class="n">requirements</span><span class="o">.</span><span class="n">txt</span><span class="w">          </span><span class="c1"># Dependencies</span>
<span class="err">├──</span><span class="w"> </span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">example</span><span class="w">              </span><span class="c1"># Template for environment variables</span>
<span class="err">├──</span><span class="w"> </span><span class="o">.</span><span class="n">env</span><span class="w">                      </span><span class="c1"># Environment variables (not in version control)</span>
<span class="err">├──</span><span class="w"> </span><span class="n">setup</span><span class="o">.</span><span class="n">py</span><span class="w">                  </span><span class="c1"># Package setup for distribution</span>
<span class="err">├──</span><span class="w"> </span><span class="n">run</span><span class="o">.</span><span class="n">py</span><span class="w">                    </span><span class="c1"># CLI entry point</span>
<span class="err">├──</span><span class="w"> </span><span class="n">chat</span><span class="o">.</span><span class="n">py</span><span class="w">                   </span><span class="c1"># Script to interact with deployed agent via SDK</span>
<span class="err">├──</span><span class="w"> </span><span class="n">deploy_agent_engine</span><span class="o">.</span><span class="n">py</span><span class="w">    </span><span class="c1"># Script for Vertex AI Agent Engine deployment</span>
<span class="err">├──</span><span class="w"> </span><span class="n">deployment_config</span><span class="o">.</span><span class="n">yaml</span><span class="w">    </span><span class="c1"># Base configuration for deployment</span>
<span class="err">├──</span><span class="w"> </span><span class="n">environments</span><span class="o">/</span><span class="w">             </span><span class="c1"># Environment-specific configurations</span>
<span class="err">│</span><span class="w">   </span><span class="err">├──</span><span class="w"> </span><span class="n">development</span><span class="o">.</span><span class="n">yaml</span><span class="w">      </span><span class="c1"># Development environment configuration</span>
<span class="err">│</span><span class="w">   </span><span class="err">├──</span><span class="w"> </span><span class="n">staging</span><span class="o">.</span><span class="n">yaml</span><span class="w">          </span><span class="c1"># Staging environment configuration</span>
<span class="err">│</span><span class="w">   </span><span class="err">└──</span><span class="w"> </span><span class="n">production</span><span class="o">.</span><span class="n">yaml</span><span class="w">       </span><span class="c1"># Production environment configuration</span>
<span class="err">├──</span><span class="w"> </span><span class="n">docs</span><span class="o">/</span>
<span class="err">│</span><span class="w">   </span><span class="err">├──</span><span class="w"> </span><span class="n">DOCUMENTATION_1</span><span class="o">.</span><span class="n">md</span><span class="w">    </span><span class="c1"># This document (comprehensive documentation)</span>
<span class="err">│</span><span class="w">   </span><span class="err">├──</span><span class="w"> </span><span class="n">PLANNING</span><span class="o">.</span><span class="n">md</span><span class="w">           </span><span class="c1"># Architecture and planning document</span>
<span class="err">│</span><span class="w">   </span><span class="err">├──</span><span class="w"> </span><span class="n">PYDANTIC_USAGE</span><span class="o">.</span><span class="n">md</span><span class="w">     </span><span class="c1"># Guidelines for using Pydantic</span>
<span class="err">│</span><span class="w">   </span><span class="err">├──</span><span class="w"> </span><span class="n">AGENT_ENGINE_DEPLOYMENT</span><span class="o">.</span><span class="n">md</span><span class="w"> </span><span class="c1"># Guide for Agent Engine deployment</span>
<span class="err">│</span><span class="w">   </span><span class="err">├──</span><span class="w"> </span><span class="n">project_visualization</span><span class="o">.</span><span class="n">html</span><span class="w"> </span><span class="c1"># Project structure visualization</span>
<span class="err">│</span><span class="w">   </span><span class="err">├──</span><span class="w"> </span><span class="n">project_visualization</span><span class="o">.</span><span class="n">md</span><span class="w">   </span><span class="c1"># Project structure in markdown</span>
<span class="err">│</span><span class="w">   </span><span class="err">└──</span><span class="w"> </span><span class="n">ACTION_ITEMS</span><span class="o">.</span><span class="n">md</span><span class="w">       </span><span class="c1"># Action items and improvements</span>
<span class="err">├──</span><span class="w"> </span><span class="n">src</span><span class="o">/</span>
<span class="err">│</span><span class="w">   </span><span class="err">├──</span><span class="w"> </span><span class="n">__init__</span><span class="o">.</span><span class="n">py</span>
<span class="err">│</span><span class="w">   </span><span class="err">├──</span><span class="w"> </span><span class="n">config</span><span class="o">.</span><span class="n">py</span><span class="w">             </span><span class="c1"># Configuration settings</span>
<span class="err">│</span><span class="w">   </span><span class="err">├──</span><span class="w"> </span><span class="n">cli</span><span class="o">.</span><span class="n">py</span><span class="w">                </span><span class="c1"># CLI implementation</span>
<span class="err">│</span><span class="w">   </span><span class="err">├──</span><span class="w"> </span><span class="n">registry</span><span class="o">.</span><span class="n">py</span><span class="w">           </span><span class="c1"># Agent registry for dynamic agent creation</span>
<span class="err">│</span><span class="w">   </span><span class="err">├──</span><span class="w"> </span><span class="n">agents</span><span class="o">/</span>
<span class="err">│</span><span class="w">   </span><span class="err">│</span><span class="w">   </span><span class="err">├──</span><span class="w"> </span><span class="n">__init__</span><span class="o">.</span><span class="n">py</span>
<span class="err">│</span><span class="w">   </span><span class="err">│</span><span class="w">   </span><span class="err">└──</span><span class="w"> </span><span class="n">base_agent</span><span class="o">.</span><span class="n">py</span><span class="w">     </span><span class="c1"># Base agent implementation (includes search tool)</span>
<span class="err">│</span><span class="w">   </span><span class="err">├──</span><span class="w"> </span><span class="n">tools</span><span class="o">/</span>
<span class="err">│</span><span class="w">   </span><span class="err">│</span><span class="w">   </span><span class="err">├──</span><span class="w"> </span><span class="n">__init__</span><span class="o">.</span><span class="n">py</span>
<span class="err">│</span><span class="w">   </span><span class="err">│</span><span class="w">   </span><span class="err">└──</span><span class="w"> </span><span class="n">custom_tools</span><span class="o">.</span><span class="n">py</span><span class="w">   </span><span class="c1"># Template for creating custom tools</span>
<span class="err">│</span><span class="w">   </span><span class="err">├──</span><span class="w"> </span><span class="n">utils</span><span class="o">/</span>
<span class="err">│</span><span class="w">   </span><span class="err">│</span><span class="w">   </span><span class="err">├──</span><span class="w"> </span><span class="n">__init__</span><span class="o">.</span><span class="n">py</span>
<span class="err">│</span><span class="w">   </span><span class="err">│</span><span class="w">   </span><span class="err">├──</span><span class="w"> </span><span class="n">auth</span><span class="o">.</span><span class="n">py</span><span class="w">           </span><span class="c1"># Authentication utilities</span>
<span class="err">│</span><span class="w">   </span><span class="err">│</span><span class="w">   </span><span class="err">└──</span><span class="w"> </span><span class="n">logging</span><span class="o">.</span><span class="n">py</span><span class="w">        </span><span class="c1"># Logging configuration</span>
<span class="err">│</span><span class="w">   </span><span class="err">└──</span><span class="w"> </span><span class="n">deployment</span><span class="o">/</span>
<span class="err">│</span><span class="w">       </span><span class="err">├──</span><span class="w"> </span><span class="n">__init__</span><span class="o">.</span><span class="n">py</span>
<span class="err">│</span><span class="w">       </span><span class="err">├──</span><span class="w"> </span><span class="n">local</span><span class="o">.</span><span class="n">py</span><span class="w">          </span><span class="c1"># Local deployment utilities</span>
<span class="err">│</span><span class="w">       </span><span class="err">└──</span><span class="w"> </span><span class="n">vertex</span><span class="o">.</span><span class="n">py</span><span class="w">         </span><span class="c1"># Vertex AI deployment utilities</span>
<span class="err">├──</span><span class="w"> </span><span class="n">examples</span><span class="o">/</span>
<span class="err">│</span><span class="w">   </span><span class="err">├──</span><span class="w"> </span><span class="n">simple_search_agent</span><span class="o">.</span><span class="n">py</span><span class="w">       </span><span class="c1"># Basic search agent example</span>
<span class="err">│</span><span class="w">   </span><span class="err">├──</span><span class="w"> </span><span class="n">multi_tool_agent</span><span class="o">.</span><span class="n">py</span><span class="w">          </span><span class="c1"># Example with multiple tools</span>
<span class="err">│</span><span class="w">   </span><span class="err">└──</span><span class="w"> </span><span class="n">streaming_agent</span><span class="o">.</span><span class="n">py</span><span class="w">           </span><span class="c1"># Example with streaming capabilities</span>
<span class="err">└──</span><span class="w"> </span><span class="n">tests</span><span class="o">/</span>
<span class="w">    </span><span class="err">├──</span><span class="w"> </span><span class="n">__init__</span><span class="o">.</span><span class="n">py</span>
<span class="w">    </span><span class="err">└──</span><span class="w"> </span><span class="n">test_custom_tools</span><span class="o">.</span><span class="n">py</span><span class="w">         </span><span class="c1"># Tests for custom tools</span>
</code></pre></div>

<p>Key files and directories:</p>
<ol>
<li><strong>run.py</strong>: Entry point for running agents via CLI</li>
<li><strong>chat.py</strong>: Script for interacting with agents deployed on Vertex AI Agent Engine</li>
<li><strong>deploy_agent_engine.py</strong>: Script for deploying agents to Vertex AI Agent Engine</li>
<li><strong>src/registry.py</strong>: Registry for agent types, allowing dynamic agent creation</li>
<li><strong>src/agents/base_agent.py</strong>: Base agent implementation that inherits from Google's BaseAgent</li>
<li><strong>src/tools/custom_tools.py</strong>: Templates and utilities for creating custom tools</li>
</ol>
<h3 id="running-the-agent">Running the Agent</h3>
<h4 id="interactive-mode">Interactive Mode</h4>
<p>Run the base agent in interactive mode:</p>
<div class="codehilite"><pre><span></span><code>python<span class="w"> </span>run.py<span class="w"> </span>run<span class="w"> </span>base<span class="w"> </span>--interactive
</code></pre></div>

<p>This will start an interactive session where you can chat with the agent.</p>
<h4 id="programmatic-use">Programmatic Use</h4>
<p>You can also use the agent programmatically in your code:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">src.agents.base_agent</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseAgent</span> <span class="c1"># Use BaseAgent now</span>

<span class="c1"># Create a base agent (includes search tool via registry)</span>
<span class="n">agent</span> <span class="o">=</span> <span class="n">BaseAgent</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;my_base_agent&quot;</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;My custom base agent with search&quot;</span><span class="p">,</span>
    <span class="n">instruction</span><span class="o">=</span><span class="s2">&quot;Answer questions using Google Search&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Run the agent</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">run_and_get_response</span><span class="p">(</span><span class="n">user_id</span><span class="o">=</span><span class="s2">&quot;prog_user&quot;</span><span class="p">,</span> <span class="n">session_id</span><span class="o">=</span><span class="s2">&quot;prog_session&quot;</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s2">&quot;What is the capital of France?&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
</code></pre></div>

<h2 id="development-workflow">Development Workflow</h2>
<h3 id="creating-a-new-agent">Creating a New Agent</h3>
<p>To create a new agent, extend the <code>BaseAgent</code> class and implement the required methods:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">src.agents.base_agent</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseAgent</span>

<span class="k">class</span><span class="w"> </span><span class="nc">MyCustomAgent</span><span class="p">(</span><span class="n">BaseAgent</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    My custom agent implementation.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;my_custom_agent&quot;</span><span class="p">,</span>
        <span class="n">model</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;gemini-2.0-flash&quot;</span><span class="p">,</span>
        <span class="n">description</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;My custom agent&quot;</span><span class="p">,</span>
        <span class="n">instruction</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;I am a custom agent&quot;</span><span class="p">,</span>
        <span class="n">session_service</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">app_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">additional_tools</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="c1"># Initialize tools</span>
        <span class="n">tools</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">additional_tools</span><span class="p">:</span>
            <span class="n">tools</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">additional_tools</span><span class="p">)</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
            <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="n">description</span><span class="p">,</span>
            <span class="n">instruction</span><span class="o">=</span><span class="n">instruction</span><span class="p">,</span>
            <span class="n">tools</span><span class="o">=</span><span class="n">tools</span><span class="p">,</span>
            <span class="n">session_service</span><span class="o">=</span><span class="n">session_service</span><span class="p">,</span>
            <span class="n">app_name</span><span class="o">=</span><span class="n">app_name</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="nd">@override</span>
    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_run_async_impl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ctx</span><span class="p">:</span> <span class="n">InvocationContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AsyncGenerator</span><span class="p">[</span><span class="n">Event</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Implement the custom orchestration logic for this agent.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Implement your custom logic here</span>
        <span class="k">async</span> <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_llm_agent</span><span class="o">.</span><span class="n">run_async</span><span class="p">(</span><span class="n">ctx</span><span class="p">):</span>
            <span class="k">yield</span> <span class="n">event</span>
</code></pre></div>

<h3 id="creating-a-new-tool">Creating a New Tool</h3>
<p>To create a new tool, define a function with a descriptive docstring:</p>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">my_custom_tool</span><span class="p">(</span><span class="n">param1</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">param2</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    My custom tool that does something useful.</span>

<span class="sd">    Args:</span>
<span class="sd">        param1: The first parameter.</span>
<span class="sd">        param2: The second parameter.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: The result of the tool.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Implement your tool logic here</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Result: </span><span class="si">{</span><span class="n">param1</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">param2</span><span class="si">}</span><span class="s2">&quot;</span>
</code></pre></div>

<p>Then, add the tool to your agent:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">src.tools.custom_tools</span><span class="w"> </span><span class="kn">import</span> <span class="n">my_custom_tool</span>

<span class="n">agent</span> <span class="o">=</span> <span class="n">MyCustomAgent</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;my_agent&quot;</span><span class="p">,</span>
    <span class="n">additional_tools</span><span class="o">=</span><span class="p">[</span><span class="n">my_custom_tool</span><span class="p">],</span>
<span class="p">)</span>
</code></pre></div>

<h3 id="advanced-orchestration">Advanced Orchestration</h3>
<p>For more complex orchestration patterns, you can implement custom logic in the <code>_run_async_impl</code> method:</p>
<div class="codehilite"><pre><span></span><code><span class="nd">@override</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_run_async_impl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ctx</span><span class="p">:</span> <span class="n">InvocationContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AsyncGenerator</span><span class="p">[</span><span class="n">Event</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Implement complex orchestration logic.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Get the user&#39;s message from the context</span>
    <span class="n">user_message</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;user_message&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

    <span class="c1"># Conditional logic based on the message</span>
    <span class="k">if</span> <span class="s2">&quot;search&quot;</span> <span class="ow">in</span> <span class="n">user_message</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
        <span class="c1"># Use the search agent</span>
        <span class="k">async</span> <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search_agent</span><span class="o">.</span><span class="n">run_async</span><span class="p">(</span><span class="n">ctx</span><span class="p">):</span>
            <span class="k">yield</span> <span class="n">event</span>
    <span class="k">elif</span> <span class="s2">&quot;calculate&quot;</span> <span class="ow">in</span> <span class="n">user_message</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
        <span class="c1"># Use the calculator agent</span>
        <span class="k">async</span> <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculator_agent</span><span class="o">.</span><span class="n">run_async</span><span class="p">(</span><span class="n">ctx</span><span class="p">):</span>
            <span class="k">yield</span> <span class="n">event</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Use the default LLM agent</span>
        <span class="k">async</span> <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_llm_agent</span><span class="o">.</span><span class="n">run_async</span><span class="p">(</span><span class="n">ctx</span><span class="p">):</span>
            <span class="k">yield</span> <span class="n">event</span>
</code></pre></div>

<h2 id="testing">Testing</h2>
<h3 id="running-tests">Running Tests</h3>
<p>Run the tests using pytest:</p>
<div class="codehilite"><pre><span></span><code>pytest<span class="w"> </span>tests/
</code></pre></div>

<h3 id="writing-tests">Writing Tests</h3>
<p>When creating a new agent or tool, write unit tests to ensure it works correctly:</p>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">test_my_custom_tool</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test the my_custom_tool function.&quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">my_custom_tool</span><span class="p">(</span><span class="s2">&quot;test&quot;</span><span class="p">,</span> <span class="mi">42</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">result</span> <span class="o">==</span> <span class="s2">&quot;Result: test, 42&quot;</span>

<span class="k">class</span><span class="w"> </span><span class="nc">TestMyCustomAgent</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Tests for the MyCustomAgent class.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set up test fixtures.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">agent</span> <span class="o">=</span> <span class="n">MyCustomAgent</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;test_agent&quot;</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Test agent&quot;</span><span class="p">,</span>
            <span class="n">instruction</span><span class="o">=</span><span class="s2">&quot;Test instruction&quot;</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">test_init</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test initialization of the agent.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;test_agent&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">description</span><span class="p">,</span> <span class="s2">&quot;Test agent&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">_instruction</span><span class="p">,</span> <span class="s2">&quot;Test instruction&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">test_run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test running the agent.&quot;&quot;&quot;</span>
        <span class="c1"># Mock the necessary components</span>
        <span class="c1"># ...</span>

        <span class="c1"># Run the agent</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">run_and_get_response</span><span class="p">(</span><span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;session&quot;</span><span class="p">,</span> <span class="s2">&quot;test message&quot;</span><span class="p">)</span>

        <span class="c1"># Check the response</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s2">&quot;Expected response&quot;</span><span class="p">)</span>
</code></pre></div>

<h2 id="deployment">Deployment</h2>
<h3 id="local-deployment">Local Deployment</h3>
<p>For local development and testing, you can run the agent using the CLI:</p>
<div class="codehilite"><pre><span></span><code>python<span class="w"> </span>run.py<span class="w"> </span>run<span class="w"> </span>search<span class="w"> </span>--interactive
</code></pre></div>

<h3 id="vertex-ai-deployment">Vertex AI Deployment</h3>
<p>For production deployment, you can deploy the agent to Vertex AI using one of two approaches:</p>
<h4 id="option-1-vertex-ai-endpoint-deployment-alternative">Option 1: Vertex AI Endpoint Deployment (Alternative)</h4>
<p>This option deploys the agent as a Vertex AI endpoint using the traditional approach via <code>deploy.py</code>:</p>
<ol>
<li>
<p>Set up your Google Cloud project:
   <code>bash
   gcloud config set project your-project-id</code></p>
</li>
<li>
<p>Enable the required APIs:
   <code>bash
   gcloud services enable aiplatform.googleapis.com</code></p>
</li>
<li>
<p>Deploy the agent:
   <code>bash
   python deploy.py --vertex --environment production</code>
<em>(Note: This uses a different deployment script and method than Agent Engine)</em></p>
</li>
</ol>
<h4 id="option-2-vertex-ai-agent-engine-deployment-recommended">Option 2: Vertex AI Agent Engine Deployment (Recommended)</h4>
<p>This option deploys the agent to Vertex AI Agent Engine, which is a fully managed service specifically designed for AI agents:</p>
<ol>
<li>
<p>Set up your Google Cloud project:
   <code>bash
   gcloud config set project your-project-id</code></p>
</li>
<li>
<p>Enable the required APIs:
   <code>bash
   gcloud services enable aiplatform.googleapis.com</code></p>
</li>
<li>
<p>Install the required dependencies:
   <code>bash
   pip install 'google-cloud-aiplatform[adk,agent_engines]'</code></p>
</li>
<li>
<p>Deploy the agent:
   <code>bash
   python deploy_agent_engine.py --environment production --staging-bucket gs://your-bucket-name</code></p>
</li>
</ol>
<p>For detailed instructions on deploying to Agent Engine, see the <a href="docs/AGENT_ENGINE_DEPLOYMENT.md">Agent Engine Deployment Guide</a>.</p>
<h2 id="best-practices">Best Practices</h2>
<h3 id="agent-design">Agent Design</h3>
<ol>
<li><strong>Keep Agents Focused</strong>: Each agent should have a clear, specific purpose.</li>
<li><strong>Use Descriptive Names</strong>: Choose clear, descriptive names for agents and tools.</li>
<li><strong>Write Clear Instructions</strong>: Provide clear, detailed instructions for the agent.</li>
<li><strong>Leverage Tools</strong>: Use tools to extend the agent's capabilities.</li>
<li><strong>Implement Proper Error Handling</strong>: Handle errors gracefully and provide helpful error messages.</li>
</ol>
<h3 id="tool-design">Tool Design</h3>
<ol>
<li><strong>Keep Tools Simple</strong>: Each tool should do one thing well.</li>
<li><strong>Write Clear Docstrings</strong>: Provide clear, detailed docstrings for tools.</li>
<li><strong>Validate Inputs</strong>: Validate inputs to prevent errors.</li>
<li><strong>Return Structured Data</strong>: Return structured data that's easy to process.</li>
<li><strong>Handle Errors Gracefully</strong>: Catch and handle errors appropriately.</li>
</ol>
<h3 id="testing_1">Testing</h3>
<ol>
<li><strong>Write Unit Tests</strong>: Write unit tests for all components.</li>
<li><strong>Test Edge Cases</strong>: Test edge cases and error conditions.</li>
<li><strong>Use Mocks</strong>: Use mocks to isolate components during testing.</li>
<li><strong>Test Integration</strong>: Test the integration between components.</li>
<li><strong>Automate Testing</strong>: Set up CI/CD to run tests automatically.</li>
</ol>
<h2 id="troubleshooting">Troubleshooting</h2>
<h3 id="common-issues">Common Issues</h3>
<h4 id="api-key-issues">API Key Issues</h4>
<p><strong>Symptom</strong>: Error message about invalid or missing API key.</p>
<p><strong>Solution</strong>: 
1. Check that your API key is set correctly in the <code>.env</code> file.
2. Verify that the API key is valid and has the necessary permissions.
3. If using Vertex AI, ensure that the service account has the necessary permissions.</p>
<h4 id="model-issues">Model Issues</h4>
<p><strong>Symptom</strong>: Error message about invalid model or model not found.</p>
<p><strong>Solution</strong>:
1. Check that the model name is correct and supported.
2. Verify that the model is available in your region.
3. If using a custom model, ensure that it's properly deployed and accessible.</p>
<h4 id="tool-issues">Tool Issues</h4>
<p><strong>Symptom</strong>: Error message about tool execution failure.</p>
<p><strong>Solution</strong>:
1. Check that the tool is properly implemented and registered.
2. Verify that the tool's inputs are valid.
3. Check the tool's error handling to ensure it handles errors gracefully.</p>
<h3 id="debugging">Debugging</h3>
<h4 id="enabling-debug-logging">Enabling Debug Logging</h4>
<p>To enable debug logging, set the <code>LOG_LEVEL</code> environment variable to <code>DEBUG</code>:</p>
<div class="codehilite"><pre><span></span><code><span class="nb">export</span><span class="w"> </span><span class="nv">LOG_LEVEL</span><span class="o">=</span>DEBUG
</code></pre></div>

<p>Or in your <code>.env</code> file:</p>
<div class="codehilite"><pre><span></span><code>LOG_LEVEL=DEBUG
</code></pre></div>

<h4 id="using-the-debugger">Using the Debugger</h4>
<p>You can use the Python debugger to step through the code:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">pdb</span>

<span class="c1"># Add a breakpoint</span>
<span class="n">pdb</span><span class="o">.</span><span class="n">set_trace</span><span class="p">()</span>
</code></pre></div>

<h4 id="inspecting-state">Inspecting State</h4>
<p>To inspect the agent's state, you can add logging statements:</p>
<div class="codehilite"><pre><span></span><code><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Session state: </span><span class="si">{</span><span class="n">ctx</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">state</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h2 id="future-roadmap">Future Roadmap</h2>
<h3 id="short-term-goals-1-3-months">Short-term Goals (1-3 months)</h3>
<ol>
<li><strong>Enhance Tool Support</strong>: Add more built-in tools for common tasks.</li>
<li><strong>Improve Documentation</strong>: Expand documentation with more examples and tutorials.</li>
<li><strong>Add Monitoring</strong>: Implement monitoring and logging for better observability.</li>
</ol>
<h3 id="medium-term-goals-3-6-months">Medium-term Goals (3-6 months)</h3>
<ol>
<li><strong>Multi-agent Orchestration</strong>: Implement more advanced multi-agent orchestration patterns.</li>
<li><strong>Memory and Context Management</strong>: Improve memory and context management for longer conversations.</li>
<li><strong>Performance Optimization</strong>: Optimize performance for faster response times.</li>
</ol>
<h3 id="long-term-goals-6-12-months">Long-term Goals (6-12 months)</h3>
<ol>
<li><strong>Advanced Reasoning</strong>: Implement more advanced reasoning capabilities.</li>
<li><strong>Multi-modal Support</strong>: Add support for images, audio, and video.</li>
<li><strong>Enterprise Integration</strong>: Integrate with enterprise systems and workflows.</li>
</ol>
<h2 id="references">References</h2>
<h3 id="project-documentation">Project Documentation</h3>
<ul>
<li><a href="../README.md">README.md</a> - Overview and getting started guide</li>
<li><a href="PLANNING.md">PLANNING.md</a> - Architecture, design decisions, and development roadmap</li>
<li><a href="PYDANTIC_USAGE.md">PYDANTIC_USAGE.md</a> - Guidelines for using Pydantic in agent classes</li>
<li><a href="AGENT_ENGINE_DEPLOYMENT.md">AGENT_ENGINE_DEPLOYMENT.md</a> - Guide for deploying to Vertex AI Agent Engine</li>
<li><a href="ACTION_ITEMS.md">ACTION_ITEMS.md</a> - Action items and improvements for the project</li>
<li><a href="../TASK.md">TASK.md</a> - Current and completed tasks</li>
</ul>
<h3 id="google-adk-documentation">Google ADK Documentation</h3>
<ul>
<li><a href="https://cloud.google.com/vertex-ai/docs/agent-development-kit/overview">Google ADK Overview</a></li>
<li><a href="https://cloud.google.com/vertex-ai/docs/agent-development-kit/custom-agents">Custom Agents</a></li>
<li><a href="https://cloud.google.com/vertex-ai/docs/agent-development-kit/llm-agents">LLM Agents</a></li>
<li><a href="https://cloud.google.com/vertex-ai/docs/agent-development-kit/tools">Tools</a></li>
</ul>
<h3 id="gemini-api-documentation">Gemini API Documentation</h3>
<ul>
<li><a href="https://cloud.google.com/vertex-ai/docs/generative-ai/model-reference/gemini">Gemini API Overview</a></li>
<li><a href="https://cloud.google.com/vertex-ai/docs/generative-ai/model-reference/gemini-api">Gemini API Reference</a></li>
</ul>
<h3 id="python-documentation">Python Documentation</h3>
<ul>
<li><a href="https://docs.python.org/3.8/">Python 3.8 Documentation</a></li>
<li><a href="https://docs.python.org/3.8/library/asyncio.html">asyncio Documentation</a></li>
<li><a href="https://docs.pydantic.dev/">Pydantic Documentation</a></li>
</ul>
<hr />
<h2 id="conclusion">Conclusion</h2>
<p>This documentation provides a comprehensive guide to our Google ADK Agent Starter Kit. It covers the architecture, implementation details, usage instructions, and best practices for building intelligent agents using Google's Agent Development Kit.</p>
<p>This document works in conjunction with the <code>PLANNING.md</code> file, which provides a more focused view of the architecture, design decisions, and roadmap. While this document provides comprehensive details on implementation and usage, <code>PLANNING.md</code> offers a higher-level strategic overview that can be useful for new team members and for making architectural decisions.</p>
<p>As we continue to develop and enhance this starter kit, we'll update both this documentation and the related documentation files to reflect new features and improvements. If you have any questions or feedback, please don't hesitate to reach out to the development team.</p>
<p>Happy agent building!</p>
<hr />
<p><em>Document Version: 1.2</em><br />
<em>Last Updated: April 22, 2025</em><br />
<em>Author: [Your Name], CTO</em></p>
<h2 id="recent-updates">Recent Updates</h2>
<p>The following improvements have been made to the Google ADK Agent Starter Kit:</p>
<ol>
<li>
<p><strong>Creation of Consolidated Planning Document</strong>: A new <code>PLANNING.md</code> document has been created to serve as a centralized reference for the project's architecture, design decisions, and roadmap. This document complements the comprehensive information in this documentation file.</p>
</li>
<li>
<p><strong>Fixed Vertex AI Agent Engine Deployment</strong>: Fixed deployment to Vertex AI Agent Engine by adding <code>extra_packages=['./src']</code> to the <code>agent_engines.create</code> call in <code>deploy_agent_engine.py</code>. Also created <code>chat.py</code> to interact with the deployed agent via the Python SDK due to lack of Console UI and <code>gcloud</code> support.</p>
</li>
<li>
<p><strong>Updated Project Documentation</strong>: Updated README.md and other documentation to reflect the current project structure and removed references to non-existent files.</p>
</li>
<li>
<p><strong>Fixed Vertex AI Deployment Mechanism</strong>: The Vertex AI deployment mechanism (for standard endpoints via <code>deploy.py</code>) was redesigned to correctly package and instantiate custom agent classes. <em>(Note: This is separate from the Agent Engine deployment fix)</em>.</p>
</li>
<li>
<p><strong>Improved CLI Extensibility</strong>: The CLI was refactored to use a registry pattern (<code>src/registry.py</code>) for agent types, making it easier to add new agent types without modifying the CLI code directly.</p>
</li>
<li>
<p><strong>Refactored Local Deployment UI</strong>: The local deployment UI has been refactored to use static HTML templates and separate CSS and JavaScript files, improving maintainability and separation of concerns. The UI now has a more modern look and feel with responsive design elements.</p>
</li>
<li>
<p><strong>Standardized Pydantic Usage</strong>: We've implemented a hybrid approach for Pydantic usage in agent classes. This approach uses validation methods like <code>_validate_model()</code> and <code>_validate_tools()</code> to validate inputs, while maintaining compatibility with the ADK's BaseAgent class. See the <a href="PYDANTIC_USAGE.md">Pydantic Usage Guidelines</a> for more details.</p>
</li>
<li>
<p><strong>Migrated Tests to pytest</strong>: All tests have been migrated from unittest to pytest, improving test readability and maintainability. The test suite now uses fixtures for common test scenarios and assertions use the pytest style. See the <a href="TEST_REPORT.md">Test Report</a> for more details.</p>
</li>
<li>
<p><strong>Improved Port Handling in Local Deployment</strong>: The local deployment mechanism now handles the case where the default port is already in use by automatically trying the next available port.</p>
</li>
</ol>
<p>These improvements address the issues identified in the code review report and make the starter kit more robust and extensible.</p>
<h2 id="documentation-resources">Documentation Resources</h2>
<p>For additional information about the project, please refer to the following resources:</p>
<ul>
<li><a href="PLANNING.md">PLANNING.md</a> - A consolidated reference for the project's architecture, design decisions, and development roadmap.</li>
<li><a href="PYDANTIC_USAGE.md">PYDANTIC_USAGE.md</a> - Guidelines for using Pydantic in agent classes.</li>
<li><a href="AGENT_ENGINE_DEPLOYMENT.md">AGENT_ENGINE_DEPLOYMENT.md</a> - Detailed guide for deploying to Vertex AI Agent Engine.</li>
</ul>
<h2 id="pydantic-usage">Pydantic Usage</h2>
<p>Our starter kit uses a hybrid approach for Pydantic integration in agent classes:</p>
<h3 id="current-implementation">Current Implementation</h3>
<div class="codehilite"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">BaseAgent</span><span class="p">(</span><span class="n">ADKBaseAgent</span><span class="p">):</span>
    <span class="c1"># Define model_config for Pydantic</span>
    <span class="n">model_config</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;arbitrary_types_allowed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">model</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">DEFAULT_MODEL</span><span class="p">,</span>
        <span class="n">description</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">instruction</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">tools</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">sub_agents</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">session_service</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">app_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="c1"># Validate inputs before passing to parent class</span>
        <span class="n">validated_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_model</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
        <span class="n">validated_tools</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_tools</span><span class="p">(</span><span class="n">tools</span><span class="p">)</span>
        <span class="n">validated_app_name</span> <span class="o">=</span> <span class="n">app_name</span> <span class="ow">or</span> <span class="n">name</span>

        <span class="c1"># Initialize the parent class first</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="n">description</span><span class="p">,</span>
            <span class="n">sub_agents</span><span class="o">=</span><span class="n">sub_agents</span> <span class="ow">or</span> <span class="p">[],</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Store parameters as instance attributes with leading underscore</span>
        <span class="c1"># to indicate they are &quot;private&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_model</span> <span class="o">=</span> <span class="n">validated_model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_instruction</span> <span class="o">=</span> <span class="n">instruction</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tools</span> <span class="o">=</span> <span class="n">validated_tools</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_app_name</span> <span class="o">=</span> <span class="n">validated_app_name</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_validate_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate the model parameter.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">model</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">DEFAULT_MODEL</span>
        <span class="c1"># Add additional validation logic here</span>
        <span class="k">return</span> <span class="n">model</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_validate_tools</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tools</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate the tools parameter.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">tools</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>
        <span class="c1"># Add additional validation logic here</span>
        <span class="k">return</span> <span class="n">tools</span>
</code></pre></div>

<h3 id="key-features_1">Key Features</h3>
<ol>
<li>
<p><strong>Model Configuration</strong>: All agent classes define <code>model_config = {"arbitrary_types_allowed": True}</code> to allow non-Pydantic types.</p>
</li>
<li>
<p><strong>Validation Methods</strong>: Instead of using Pydantic fields directly, we use validation methods like <code>_validate_model()</code> and <code>_validate_tools()</code> to validate inputs.</p>
</li>
<li>
<p><strong>Private Attributes</strong>: Parameters are stored as instance attributes with leading underscores to indicate they are "private".</p>
</li>
</ol>
<h3 id="benefits">Benefits</h3>
<p>This approach provides several benefits:
- Maintains compatibility with the ADK's BaseAgent class
- Allows for explicit validation of inputs
- Follows Python conventions for private attributes
- Simplifies the code structure</p>
<p>For more details, see the <a href="PYDANTIC_USAGE.md">Pydantic Usage Guidelines</a>.</p>
        
        <div class="footer">
            <p>Generated on 2025-04-21 09:00:32</p>
            <p><a href="index.html">Back to Documentation Index</a></p>
        </div>
    </body>
    </html>
    